<!--
To change this template, choose Tools | Templates
and open the template in the editor.
-->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
    <head>
        <title>Radio 1 Demo</title>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
		<style>
			#timeline {
				width:150%;
				text-align: right;
			}
			#container {
				overflow: scroll;
				min-height: 400px;
			}

			.front_box {
				border: 1px solid;
				padding:2px;
				position: relative;
			}

			.front_box img {
				position: relative;
			}

			.image_preview{
				margin-right: 20px;
				float:left;
			}

			.small_box, .small_box img {
				width:74px;
				height:74px;
			}

			.medium_box, .medium_box img {
				width:156px;
				height:156px;
			}

			.large_box, .large_box img {
				width: 320px;
				height: 320px;
			}

			.box_overlay {
				margin-top: 0px;
				overflow: hidden;
				width: auto;
				float: right;
				text-align: right;
				position: relative;
				background-color: rgba(0,0,0,0.5);
				color:white;
				font-family:Arial;
				z-index: 1;
			}

			.box_blurb {
				margin: 0;
				clear: both;
			}

			.box_div {
				overflow: hidden;
				position: absolute;
				top: 50%;
				right: 0px;
			}

			.box_title {
				margin-bottom: 5px;
			}

			.column {
				float: right;
				position: relative;
				margin-right: 8px;
			}

			.box {
				margin-bottom: 8px;
			}
		</style>
    </head>
    <body>
        <script src="/javascripts/jquery.js" type="text/javascript"></script>
        <script src="http://js.pusherapp.com/1.6/pusher.min.js" type="text/javascript"></script>
        <script type="text/javascript">
			// Create a Pusher server object with your app's key
			var server = new Pusher('c0b0df1d1c0885f4eb42', 'radio1-live');
			var items = []
			var max = 100
			var updateWithNewItem = function (data_item){
				var newtimeline = ""
				while (items.length >= max) items.pop()
				for (var i = items.length; i > 0; i--){
					items[i] = items[i-1]
				}
				items[0] = data_item
				var column = ""
				var columns = []
				for (var i = 0; i < items.length; i++){
					if (i == 0){
						column = "<div class='column'>" + fetchDataFromObject(items[0], "large") + "</div>"
					}
					else if (i < 5){
						if (i % 2 == 1){
							columns[Math.ceil(i/2)] = fetchDataFromObject(items[i], "medium")
						}
						else{
							columns[Math.ceil(i/2)] += fetchDataFromObject(items[i], "medium")
						}
					}
					else{
						if (i % 4 == 1){
							columns[Math.ceil(i/4)] = fetchDataFromObject(items[i], "small")
						}
						else{
							columns[Math.ceil(i/4)] += fetchDataFromObject(items[i], "small")
						}
					}
				}
				for(var i = 1; i < columns.length; i++){
					column += "<div class='column'>" + columns[i] + "</div>"
				}
			$("#timeline").html(column)
		};

		var fetchDataFromObject = function(data, size){
			if (data.type == "BbcTrackResource") return trackHtml(data.bbc_track_resource, size)
			else return resourceHtml(data.bbc_newsbeat_resource, size)
		};
            
		var resourceHtml = function (data, size){
			img = ""
			if(data.external_image_url){
				img =  "<img src='http://open.live.bbc.co.uk/dynamic_images/radio1_square320/" + data.external_image_url + "' /> "
			}
			return createBox(size, data.title, data.blurb, img)
		};

		var trackHtml = function (data, size){
			img = ""
			if(data.external_image_url){
				img =  "<img src='http://open.live.bbc.co.uk/dynamic_images/radio1_square320/" + data.external_image_url + "' /> "
			}
			return createBox(size, data.artist_name, data.title, img)
		};

		var createBox = function (size, title, blurb, img){
			title = !title ? "" : title
			blurb = !blurb ? "" : blurb
			img = !img ? "" : img
			switch(size){
				case "small":
					return "<div class='small_box box'>" + img + "</div>"
					break;
				case "medium":
					return "<div class='medium_box box'>" + img + "</div>"
					break;
				case "large":
					return "<div class='large_box box'>" + img + "<div class='box_div'><h2 class='box_title box_overlay'>" + title + "</h2><h4 class='box_blurb box_overlay'>"+ blurb + "</h4></div></div>"
					break;
			}
		}

            




		// Bind to server events
		server.bind('added_exposure', function(data) {
			updateWithNewItem(data);
		});

            

		$(document).ready(function() {
			$("#container").scrollLeft($("#container").width())
                

		});
        </script>
		<div id="container">
			<div id="timeline">
				<div class="column">
					<div class="large_box box">
						<img src="http://open.live.bbc.co.uk/dynamic_images/radio1_square320/http://news.bbcimg.co.uk/media/images/48835000/jpg/_48835430_ivorywave_teen466.jpg">
						<div class="box_div">
							<h2 class="box_title box_overlay">Hi</h2>
							<h4 class="box_blurb box_overlay">Hi How are you doing?</h4>
						</div>
					</div>
				</div>
				<div class="column">
					<div class="medium_box box">
						<img src="http://open.live.bbc.co.uk/dynamic_images/radio1_square320/http://news.bbcimg.co.uk/media/images/48835000/jpg/_48835430_ivorywave_teen466.jpg">
					</div>
					<div class="medium_box box">
						<img src="http://open.live.bbc.co.uk/dynamic_images/radio1_square320/http://news.bbcimg.co.uk/media/images/48835000/jpg/_48835430_ivorywave_teen466.jpg">
					</div>
				</div>
				<div class="column">
					<div class="medium_box box">
						<img src="http://open.live.bbc.co.uk/dynamic_images/radio1_square320/http://news.bbcimg.co.uk/media/images/48835000/jpg/_48835430_ivorywave_teen466.jpg">
					</div>
					<div class="medium_box box">
						<img src="http://open.live.bbc.co.uk/dynamic_images/radio1_square320/http://news.bbcimg.co.uk/media/images/48835000/jpg/_48835430_ivorywave_teen466.jpg">
					</div>
				</div>
				<div class="column">
					<div class="small_box box">
						<img src="http://open.live.bbc.co.uk/dynamic_images/radio1_square320/http://news.bbcimg.co.uk/media/images/48835000/jpg/_48835430_ivorywave_teen466.jpg">
					</div>
					<div class="small_box box">
						<img src="http://open.live.bbc.co.uk/dynamic_images/radio1_square320/http://news.bbcimg.co.uk/media/images/48835000/jpg/_48835430_ivorywave_teen466.jpg">
					</div>
					<div class="small_box box">
						<img src="http://open.live.bbc.co.uk/dynamic_images/radio1_square320/http://news.bbcimg.co.uk/media/images/48835000/jpg/_48835430_ivorywave_teen466.jpg">
					</div>
					<div class="small_box box">
						<img src="http://open.live.bbc.co.uk/dynamic_images/radio1_square320/http://news.bbcimg.co.uk/media/images/48835000/jpg/_48835430_ivorywave_teen466.jpg">
					</div>
				</div>
				<div class="column">
					<div class="small_box box">
						<img src="http://open.live.bbc.co.uk/dynamic_images/radio1_square320/http://news.bbcimg.co.uk/media/images/48835000/jpg/_48835430_ivorywave_teen466.jpg">
					</div>
					<div class="small_box box">
						<img src="http://open.live.bbc.co.uk/dynamic_images/radio1_square320/http://news.bbcimg.co.uk/media/images/48835000/jpg/_48835430_ivorywave_teen466.jpg">
					</div>
					<div class="small_box box">
						<img src="http://open.live.bbc.co.uk/dynamic_images/radio1_square320/http://news.bbcimg.co.uk/media/images/48835000/jpg/_48835430_ivorywave_teen466.jpg">
					</div>
					<div class="small_box box">
						<img src="http://open.live.bbc.co.uk/dynamic_images/radio1_square320/http://news.bbcimg.co.uk/media/images/48835000/jpg/_48835430_ivorywave_teen466.jpg">
					</div>
				</div>
				<div class="column">
					<div class="small_box box">
						<img src="http://open.live.bbc.co.uk/dynamic_images/radio1_square320/http://news.bbcimg.co.uk/media/images/48835000/jpg/_48835430_ivorywave_teen466.jpg">
					</div>
					<div class="small_box box">
						<img src="http://open.live.bbc.co.uk/dynamic_images/radio1_square320/http://news.bbcimg.co.uk/media/images/48835000/jpg/_48835430_ivorywave_teen466.jpg">
					</div>
					<div class="small_box box">
						<img src="http://open.live.bbc.co.uk/dynamic_images/radio1_square320/http://news.bbcimg.co.uk/media/images/48835000/jpg/_48835430_ivorywave_teen466.jpg">
					</div>
					<div class="small_box box">
						<img src="http://open.live.bbc.co.uk/dynamic_images/radio1_square320/http://news.bbcimg.co.uk/media/images/48835000/jpg/_48835430_ivorywave_teen466.jpg">
					</div>
				</div>
				<div class="column">
					<div class="small_box box">
						<img src="http://open.live.bbc.co.uk/dynamic_images/radio1_square320/http://news.bbcimg.co.uk/media/images/48835000/jpg/_48835430_ivorywave_teen466.jpg">
					</div>
					<div class="small_box box">
						<img src="http://open.live.bbc.co.uk/dynamic_images/radio1_square320/http://news.bbcimg.co.uk/media/images/48835000/jpg/_48835430_ivorywave_teen466.jpg">
					</div>
					<div class="small_box box">
						<img src="http://open.live.bbc.co.uk/dynamic_images/radio1_square320/http://news.bbcimg.co.uk/media/images/48835000/jpg/_48835430_ivorywave_teen466.jpg">
					</div>
					<div class="small_box box">
						<img src="http://open.live.bbc.co.uk/dynamic_images/radio1_square320/http://news.bbcimg.co.uk/media/images/48835000/jpg/_48835430_ivorywave_teen466.jpg">
					</div>
				</div>
			</div>
		</div>
		<div>
			Hello how are you lovely people?
		</div>
    </body>
</html>